[include box1.cfg]

[box_extras]
b_button_pin : ^mcu_box1:PB1
b_endstop_pin : mcu_box1:PA9
e_endstop_pin : mcu_box1:PA10

[filament_motion_sensor box_motion_sensor]
detection_length : 50
extruder : extruder
switch_pin : ^mcu_box1:PB0
use_irq : True
debounce_us : 50
runout_gcode : 
	{% set slot_sync = printer.save_variables.variables.slot_sync|default("slot-1") %}
	{% if slot_sync != 'slot-1' %}
	SAVE_VARIABLE VARIABLE={slot_sync} VALUE=-3
	{% endif %}
	M118 Filament motion sensor detected
	MOTION_TIPS

[mcu mcu_box1]
serial : /dev/serial/by-id/usb-Klipper_QIDI_BOX_V1_1.1.1_200059001451333235373730-if00
restart_method : command

[gcode_macro UNLOAD_FILAMENT]
gcode : 
	{% if printer.save_variables.variables.enable_box == 1 %}
	{% set T = params.T|int %}
	CUT_FILAMENT T={T}
	MOVE_TO_TRASH
	UNLOAD_T{T}
	G1 E25 F300
	M104 S0
	CLEAR_FLUSH
	CLEAR_OOZE
	{% endif %}

